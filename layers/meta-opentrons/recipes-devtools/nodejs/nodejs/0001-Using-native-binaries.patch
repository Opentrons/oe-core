From ff99fd45d1d6d90c049fc71f37de3018b2a0cbeb Mon Sep 17 00:00:00 2001
From: Guillaume Burel <guillaume.burel@stormshield.eu>
Date: Fri, 3 Jan 2020 11:25:54 +0100
Subject: [PATCH] Using native binaries

Upstream-Status: Inappropriate [embedded specific]

Originally added in:
https://git.openembedded.org/meta-openembedded/commit/?id=1c8e4a679ae382f953b2e5c7a4966a4646314f3e
later extended and renamed in:
https://git.openembedded.org/meta-openembedded/commit/?id=feeb172d1a8bf010490d22b8df9448b20d9d2aed

Signed-off-by: Archana Polampalli <archana.polampalli@windriver.com>
---
 node.gyp                 | 3 +++
 tools/v8_gypfiles/v8.gyp | 5 +++++
 2 files changed, 8 insertions(+)

diff --git a/node.gyp b/node.gyp
index 4aa214c6..703d8245 100644
--- a/node.gyp
+++ b/node.gyp
@@ -724,6 +724,7 @@
                   'action_name': 'node_mksnapshot',
                   'process_outputs_as_sources': 1,
                   'inputs': [
+                    '<(PRODUCT_DIR)/v8-qemu-wrapper.sh',
                     '<(node_mksnapshot_exec)',
                     '<(node_snapshot_main)',
                   ],
@@ -1033,6 +1034,7 @@
           'action_name': 'node_js2c',
           'process_outputs_as_sources': 1,
           'inputs': [
+            '<(PRODUCT_DIR)/v8-qemu-wrapper.sh',
             '<(node_js2c_exec)',
             '<@(library_files)',
             '<@(deps_files)',
@@ -1042,6 +1044,7 @@
             '<(SHARED_INTERMEDIATE_DIR)/node_javascript.cc',
           ],
           'action': [
+            '<(PRODUCT_DIR)/v8-qemu-wrapper.sh',
             '<(node_js2c_exec)',
             '<@(_outputs)',
             'lib',
diff --git a/tools/v8_gypfiles/v8.gyp b/tools/v8_gypfiles/v8.gyp
index ed565257..baaeea42 100644
--- a/tools/v8_gypfiles/v8.gyp
+++ b/tools/v8_gypfiles/v8.gyp
@@ -81,6 +81,7 @@
         {
           'action_name': 'run_torque_action',
           'inputs': [  # Order matters.
+            '<(PRODUCT_DIR)/v8-qemu-wrapper.sh',
             '<(PRODUCT_DIR)/<(EXECUTABLE_PREFIX)torque<(EXECUTABLE_SUFFIX)',
             '<@(torque_files)',
           ],
@@ -112,6 +113,7 @@
             '<@(torque_outputs_inc)',
           ],
           'action': [
+            '<(PRODUCT_DIR)/v8-qemu-wrapper.sh',
             '<(PRODUCT_DIR)/<(EXECUTABLE_PREFIX)torque<(EXECUTABLE_SUFFIX)',
             '-o', '<(SHARED_INTERMEDIATE_DIR)/torque-generated',
             '-v8-root', '<(V8_ROOT)',
@@ -224,6 +226,7 @@
         {
           'action_name': 'generate_bytecode_builtins_list_action',
           'inputs': [
+            '<(PRODUCT_DIR)/v8-qemu-wrapper.sh',
             '<(PRODUCT_DIR)/<(EXECUTABLE_PREFIX)bytecode_builtins_list_generator<(EXECUTABLE_SUFFIX)',
           ],
           'outputs': [
@@ -411,6 +414,7 @@
             ],
           },
           'inputs': [
+            '<(PRODUCT_DIR)/v8-qemu-wrapper.sh',
             '<(mksnapshot_exec)',
           ],
           'outputs': [
@@ -1843,6 +1847,7 @@
         {
           'action_name': 'run_gen-regexp-special-case_action',
           'inputs': [
+            '<(PRODUCT_DIR)/v8-qemu-wrapper.sh',
             '<(PRODUCT_DIR)/<(EXECUTABLE_PREFIX)gen-regexp-special-case<(EXECUTABLE_SUFFIX)',
           ],
           'outputs': [
